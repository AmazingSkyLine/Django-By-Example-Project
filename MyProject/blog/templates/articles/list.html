{% extends "base.html" %}

{% block title %}文章列表{% endblock %}

{% block content %}
    <div>
        <a href="{% url 'article_create' %}" class="glyphicon glyphicon-plus" style="float: right; color: #6200EA;">创建新文章</a>
        {% if tag %}
            <h1>拥有标签“{{ tag }}”的文章</h1>
        {% elif query %}
            <h1>含有关键词“{{ query }}”的文章</h1>
        {% else %}
            <h1>文章<span class="badge">{% load article_tags %}{% total_articles %}</span></h1>
        {% endif %}
    </div>
    <div id="article-list">
        {% include 'articles/list_ajax.html' %}
    </div>

<style>
    .article-item{
        width: 100%;
        height: 165px;
        padding: 1px 10px;
        margin: 30px 0;
        background: #FBE9E7;
        opacity: 0.8;
        border-radius: 5px;
        box-shadow: 5px 5px 10px #212121;
    }
    .tag{
        float: right;
        margin: 10px 0 5px 5px;
        font-size: 15px;
    }
</style>
{% endblock %}

{% block domready %}
    var page = 1;
    var empty_page = false;
    var block_request = false;

    $(window).scroll(function() {
    var margin = $(document).height() - $(window).height() - 200;
    //scrollTop()返回滚动条位置，从0计
    if($(window).scrollTop() > margin && !empty_page && !block_request){
    block_request = true;
    page += 1;
    $.get('?page=' + page, function(data) {
    if(data === ''){
    empty_page = true;
    }
    else{
    block_request = false;
    $('#article-list').append(data);
    }
    });
    }
    });
{% endblock %}